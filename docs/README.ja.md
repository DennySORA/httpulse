# Monitor Network

[English](../README.md) | [繁體中文](README.zh-TW.md) | [简体中文](README.zh-CN.md)

インタラクティブなターミナル UI を備えたリアルタイム HTTP レイテンシおよびネットワーク品質監視ツール。高性能と信頼性のために Rust で構築されています。

![License](https://img.shields.io/badge/license-MIT-blue.svg)
![Rust](https://img.shields.io/badge/rust-1.92%2B-orange.svg)

## 特徴

### リアルタイム監視
- **リアルタイム HTTP プローブ**：設定可能な間隔でターゲット URL を継続的に監視
- **マルチターゲットサポート**：複数のエンドポイントを同時に監視
- **プロファイル比較**：異なる HTTP 設定を並べて比較

### 包括的なメトリクス

#### レイテンシメトリクス
- **DNS**：ドメイン名解決時間
- **Connect**：TCP ハンドシェイク時間
- **TLS**：TLS/SSL ハンドシェイク時間
- **TTFB**：最初のバイトまでの時間（サーバー処理時間）
- **Download**：コンテンツダウンロード時間
- **Total**：完全なリクエストライフサイクル

#### 品質と信頼性
- **RTT**：TCP_INFO からのラウンドトリップタイム（カーネルレベルの精度）
- **RTT 分散**：ネットワークパス安定性指標
- **Jitter**：プローブ間レイテンシ変動
- **Retransmissions**：TCP パケットロス指標
- **Reordering**：パケット順序乱れイベント
- **Probe Loss Rate**：アプリケーション層失敗率

#### スループットと TCP 状態
- **Goodput**：アプリケーション層スループット（bps）
- **Bandwidth Utilization**：設定されたリンク容量に対する使用率
- **cwnd**：TCP 輻輳ウィンドウサイズ
- **ssthresh**：スロースタート閾値

### 設定可能なプロファイル
- **HTTP/1.1 & HTTP/2**：異なるプロトコルバージョンをテスト
- **TLS 1.2 & TLS 1.3**：TLS バージョンのパフォーマンスを比較
- **接続再利用**：Warm（キープアライブ）vs Cold（新規接続）モード

### インタラクティブ TUI
- **リアルタイムチャート**：時系列メトリクスを可視化
- **カテゴリタブ**：整理されたメトリクス表示（レイテンシ/品質/信頼性/スループット/TCP）
- **複数のビューモード**：分割、チャートのみ、メトリクスのみ、サマリー
- **時間ウィンドウ**：1分、5分、15分、60分の集計期間
- **用語集**：組み込みの用語説明

## インストール

### 前提条件
- Rust 1.92 以降
- HTTP/2 サポート付き libcurl

### ソースからビルド

```bash
git clone https://github.com/yourusername/monitor_network.git
cd monitor_network
cargo build --release
```

バイナリは `target/release/monitor_network` に作成されます。

## 使用方法

### 基本的な使用法

```bash
# デフォルトターゲット（google.com）を監視
./monitor_network

# 特定のターゲットを監視
./monitor_network -t https://example.com

# 複数のターゲットを監視
./monitor_network -t https://google.com -t https://cloudflare.com -t https://github.com
```

### コマンドラインオプション

| オプション | 説明 | デフォルト |
|------------|------|------------|
| `-t, --target <URL>` | プローブするターゲット URL（繰り返し可能） | `https://google.com` |
| `--refresh-hz <N>` | UI リフレッシュレート（Hz） | `10` |
| `--ebpf <MODE>` | eBPF モード：off\|minimal\|full | `off` |

### キーボードショートカット

#### ナビゲーション
| キー | アクション |
|------|------------|
| `上/下` または `j/k` | ターゲットを選択 |
| `Tab` | プロファイルを切り替え |
| `[` / `]` | メトリクスカテゴリを切り替え |

#### アクション
| キー | アクション |
|------|------------|
| `a` | ターゲットを追加 |
| `d` | 選択したターゲットを削除 |
| `p` | プローブを一時停止/再開 |
| `c` | 比較モードを切り替え |

#### ビューコントロール
| キー | アクション |
|------|------------|
| `g` | ペインモードを切り替え（分割/チャート/メトリクス/サマリー） |
| `w` | 時間ウィンドウを切り替え（1m/5m/15m/60m） |
| `1-8` | チャート上のメトリクス系列を切り替え |

#### 一般
| キー | アクション |
|------|------------|
| `?` | ヘルプを表示 |
| `G` | 用語集を表示 |
| `S` | 設定を開く |
| `q` | 終了 |

### ターゲットの追加

`a` でターゲットを追加する際、カスタムプロファイルを指定できます：

```
https://example.com h2+tls13+warm h1+tls12+cold
```

プロファイル形式：`<http>+<tls>+<conn>`
- HTTP：`h1`、`h2`
- TLS：`tls12`、`tls13`
- 接続：`warm`（再利用）、`cold`（新規）

### 設定

`S` を押して設定を開き、以下を設定できます：
- **UI リフレッシュレート**：更新頻度を調整
- **リンク容量**：使用率計算のための帯域幅を設定
- **プローブ間隔**：プローブ間の時間
- **タイムアウト**：最大プローブ時間
- **DNS**：DNS 解決タイミングの有効/無効

## メトリクスの理解

### 統計表示

メトリクスは **P50/P99/Mean** で表示されます：
- **P50**：中央値（50パーセンタイル）
- **P99**：99パーセンタイル（最悪の1%のサンプル）
- **Mean**：算術平均

### 結果の解釈

| メトリクス | 良好 | 警告 | 重大 |
|------------|------|------|------|
| 成功率 | ≥99% | 95-99% | <95% |
| レイテンシ P99 | <100ms | 100-500ms | >500ms |
| 再送回数 | 0 | 1-3 | >3 |

### TCP 状態メトリクス（Linux のみ）

TCP_INFO メトリクス（`cwnd`、`ssthresh`、`rtt`、`rttvar`、`retrans`、`reordering`）はソケットオプションを通じてカーネルから抽出されます。これらはアプリケーション層のタイミングよりも正確な測定を提供します。

## アーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│                        メインスレッド                         │
│  ┌─────────┐    ┌──────────┐    ┌─────────────────────────┐│
│  │ AppState│◄───│ UI ループ │◄───│ crossbeam channel (rx)  ││
│  └─────────┘    └──────────┘    └─────────────────────────┘│
└─────────────────────────────────────────────────────────────┘
                                            ▲
                    ┌───────────────────────┴───────────────────────┐
                    │                                               │
        ┌───────────┴───────────┐               ┌───────────────────┴───────────┐
        │    ワーカースレッド 1   │               │      ワーカースレッド N        │
        │  ┌─────────────────┐  │               │  ┌─────────────────────────┐  │
        │  │  ProbeClient    │  │      ...      │  │      ProbeClient        │  │
        │  │  (libcurl)      │  │               │  │      (libcurl)          │  │
        │  └─────────────────┘  │               │  └─────────────────────────┘  │
        └───────────────────────┘               └───────────────────────────────┘
```

## システム要件

- **オペレーティングシステム**：Linux（フル機能）、macOS/Windows（限定的な TCP メトリクス）
- **Rust**：1.92+
- **依存関係**：HTTP/2 サポート付き libcurl

## ライセンス

MIT ライセンス - 詳細は [LICENSE](../LICENSE) を参照してください。

## コントリビューション

コントリビューションを歓迎します！Issue や Pull Request をお気軽にお送りください。
