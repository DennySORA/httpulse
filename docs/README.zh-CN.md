# Monitor Network

[English](../README.md) | [繁體中文](README.zh-TW.md) | [日本語](README.ja.md)

一个实时 HTTP 延迟和网络质量监控工具，具有交互式终端界面。使用 Rust 构建，提供高性能和稳定性。

![License](https://img.shields.io/badge/license-MIT-blue.svg)
![Rust](https://img.shields.io/badge/rust-1.70%2B-orange.svg)

## 特色功能

### 实时监控
- **实时 HTTP 探测**：以可配置的间隔持续监控目标 URL
- **多目标支持**：同时监控多个端点
- **配置文件比较**：并排比较不同的 HTTP 配置

### 完整的指标

#### 延迟指标
- **DNS**：域名解析时间
- **Connect**：TCP 握手时间
- **TLS**：TLS/SSL 握手时间
- **TTFB**：首字节时间（服务器处理时间）
- **Download**：内容下载时间
- **Total**：完整请求周期

#### 质量与可靠性
- **RTT**：来自 TCP_INFO 的往返时间（内核级精度）
- **RTT 变异数**：网络路径稳定性指标
- **Jitter**：探测间延迟变化
- **Retransmissions**：TCP 丢包指标
- **Reordering**：包乱序事件
- **Probe Loss Rate**：应用层失败率

#### 吞吐量与 TCP 状态
- **Goodput**：应用层吞吐量（bps）
- **Bandwidth Utilization**：相对于配置链路容量的使用率
- **cwnd**：TCP 拥塞窗口大小
- **ssthresh**：慢启动阈值

### 可配置的配置文件
- **HTTP/1.1 & HTTP/2**：测试不同的协议版本
- **TLS 1.2 & TLS 1.3**：比较 TLS 版本性能
- **连接重用**：Warm（保持连接）vs Cold（新连接）模式

### 交互式终端界面
- **实时图表**：可视化时间序列指标
- **分类标签**：组织化的指标显示（延迟/质量/可靠性/吞吐量/TCP）
- **多种视图模式**：分割、仅图表、仅指标、摘要
- **时间窗口**：1分钟、5分钟、15分钟、60分钟聚合周期
- **术语表**：内置术语解释

## 安装

### 前置需求
- Rust 1.70 或更新版本
- 支持 HTTP/2 的 libcurl

### 从源码构建

```bash
git clone https://github.com/yourusername/monitor_network.git
cd monitor_network
cargo build --release
```

可执行文件将位于 `target/release/monitor_network`。

## 使用方式

### 基本用法

```bash
# 监控默认目标（google.com）
./monitor_network

# 监控特定目标
./monitor_network -t https://example.com

# 监控多个目标
./monitor_network -t https://google.com -t https://cloudflare.com -t https://github.com
```

### 命令行选项

| 选项 | 说明 | 默认值 |
|------|------|--------|
| `-t, --target <URL>` | 要探测的目标 URL（可重复） | `https://google.com` |
| `--refresh-hz <N>` | UI 刷新频率（Hz） | `10` |
| `--ebpf <MODE>` | eBPF 模式：off\|minimal\|full | `off` |

### 键盘快捷键

#### 导航
| 按键 | 动作 |
|------|------|
| `上/下` 或 `j/k` | 选择目标 |
| `Tab` | 切换配置文件 |
| `[` / `]` | 切换指标分类 |

#### 操作
| 按键 | 动作 |
|------|------|
| `a` | 添加目标 |
| `d` | 删除选中的目标 |
| `p` | 暂停/继续探测 |
| `c` | 切换比较模式 |

#### 视图控制
| 按键 | 动作 |
|------|------|
| `g` | 切换面板模式（分割/图表/指标/摘要） |
| `w` | 切换时间窗口（1m/5m/15m/60m） |
| `1-8` | 切换图表上的指标系列 |

#### 通用
| 按键 | 动作 |
|------|------|
| `?` | 显示帮助 |
| `G` | 显示术语表 |
| `S` | 打开设置 |
| `q` | 退出 |

### 添加目标

使用 `a` 添加目标时，可以指定自定义配置文件：

```
https://example.com h2+tls13+warm h1+tls12+cold
```

配置文件格式：`<http>+<tls>+<conn>`
- HTTP：`h1`、`h2`
- TLS：`tls12`、`tls13`
- 连接：`warm`（重用）、`cold`（新建）

### 设置

按 `S` 打开设置并配置：
- **UI 刷新频率**：调整更新频率
- **链路容量**：设置带宽以计算使用率
- **探测间隔**：探测之间的时间
- **超时**：最大探测持续时间
- **DNS**：启用/禁用 DNS 解析计时

## 理解指标

### 统计显示

指标显示为 **P50/P99/Mean**：
- **P50**：中位数（第 50 百分位数）
- **P99**：第 99 百分位数（最差的 1% 样本）
- **Mean**：算术平均值

### 结果解读

| 指标 | 良好 | 警告 | 严重 |
|------|------|------|------|
| 成功率 | ≥99% | 95-99% | <95% |
| 延迟 P99 | <100ms | 100-500ms | >500ms |
| 重传次数 | 0 | 1-3 | >3 |

### TCP 状态指标（仅限 Linux）

TCP_INFO 指标（`cwnd`、`ssthresh`、`rtt`、`rttvar`、`retrans`、`reordering`）通过 socket 选项从内核提取。这些提供比应用层计时更精确的测量。

## 架构

```
┌─────────────────────────────────────────────────────────────┐
│                          主线程                              │
│  ┌─────────┐    ┌──────────┐    ┌─────────────────────────┐│
│  │ AppState│◄───│  UI 循环 │◄───│ crossbeam channel (rx)  ││
│  └─────────┘    └──────────┘    └─────────────────────────┘│
└─────────────────────────────────────────────────────────────┘
                                            ▲
                    ┌───────────────────────┴───────────────────────┐
                    │                                               │
        ┌───────────┴───────────┐               ┌───────────────────┴───────────┐
        │      工作线程 1        │               │         工作线程 N            │
        │  ┌─────────────────┐  │               │  ┌─────────────────────────┐  │
        │  │  ProbeClient    │  │      ...      │  │      ProbeClient        │  │
        │  │  (libcurl)      │  │               │  │      (libcurl)          │  │
        │  └─────────────────┘  │               │  └─────────────────────────┘  │
        └───────────────────────┘               └───────────────────────────────┘
```

## 系统需求

- **操作系统**：Linux（完整功能）、macOS/Windows（有限的 TCP 指标）
- **Rust**：1.70+
- **依赖项**：支持 HTTP/2 的 libcurl

## 许可证

MIT 许可证 - 详见 [LICENSE](../LICENSE)。

## 贡献

欢迎贡献！请随时提交问题和拉取请求。
