# Monitor Network

[English](../README.md) | [简体中文](README.zh-CN.md) | [日本語](README.ja.md)

一個即時 HTTP 延遲和網路品質監控工具，具有互動式終端介面。使用 Rust 建構，提供高效能和穩定性。

![License](https://img.shields.io/badge/license-MIT-blue.svg)
![Rust](https://img.shields.io/badge/rust-1.92%2B-orange.svg)

## 特色功能

### 即時監控
- **即時 HTTP 探測**：以可設定的間隔持續監控目標 URL
- **多目標支援**：同時監控多個端點
- **設定檔比較**：並排比較不同的 HTTP 配置

### 完整的指標

#### 延遲指標
- **DNS**：網域名稱解析時間
- **Connect**：TCP 握手時間
- **TLS**：TLS/SSL 握手時間
- **TTFB**：首位元組時間（伺服器處理時間）
- **Download**：內容下載時間
- **Total**：完整請求週期

#### 品質與可靠性
- **RTT**：來自 TCP_INFO 的往返時間（核心層級精確度）
- **RTT 變異數**：網路路徑穩定性指標
- **Jitter**：探測間延遲變化
- **Retransmissions**：TCP 封包遺失指標
- **Reordering**：封包亂序事件
- **Probe Loss Rate**：應用層失敗率

#### 吞吐量與 TCP 狀態
- **Goodput**：應用層吞吐量（bps）
- **Bandwidth Utilization**：相對於設定連結容量的使用率
- **cwnd**：TCP 壅塞視窗大小
- **ssthresh**：慢啟動閾值

### 可設定的設定檔
- **HTTP/1.1 & HTTP/2**：測試不同的協定版本
- **TLS 1.2 & TLS 1.3**：比較 TLS 版本效能
- **連線重用**：Warm（保持連線）vs Cold（新連線）模式

### 互動式終端介面
- **即時圖表**：視覺化時間序列指標
- **分類標籤**：組織化的指標顯示（延遲/品質/可靠性/吞吐量/TCP）
- **多種檢視模式**：分割、僅圖表、僅指標、摘要
- **時間視窗**：1分鐘、5分鐘、15分鐘、60分鐘聚合週期
- **術語表**：內建術語解釋

## 安裝

### 前置需求
- Rust 1.92 或更新版本
- 支援 HTTP/2 的 libcurl

### 從原始碼建構

```bash
git clone https://github.com/yourusername/monitor_network.git
cd monitor_network
cargo build --release
```

執行檔將位於 `target/release/monitor_network`。

## 使用方式

### 基本用法

```bash
# 監控預設目標（google.com）
./monitor_network

# 監控特定目標
./monitor_network -t https://example.com

# 監控多個目標
./monitor_network -t https://google.com -t https://cloudflare.com -t https://github.com
```

### 命令列選項

| 選項 | 說明 | 預設值 |
|------|------|--------|
| `-t, --target <URL>` | 要探測的目標 URL（可重複） | `https://google.com` |
| `--refresh-hz <N>` | UI 更新頻率（Hz） | `10` |
| `--ebpf <MODE>` | eBPF 模式：off\|minimal\|full | `off` |

### 鍵盤快捷鍵

#### 導航
| 按鍵 | 動作 |
|------|------|
| `上/下` 或 `j/k` | 選擇目標 |
| `Tab` | 切換設定檔 |
| `[` / `]` | 切換指標分類 |

#### 操作
| 按鍵 | 動作 |
|------|------|
| `a` | 新增目標 |
| `d` | 刪除選中的目標 |
| `p` | 暫停/繼續探測 |
| `c` | 切換比較模式 |

#### 檢視控制
| 按鍵 | 動作 |
|------|------|
| `g` | 切換面板模式（分割/圖表/指標/摘要） |
| `w` | 切換時間視窗（1m/5m/15m/60m） |
| `1-8` | 切換圖表上的指標系列 |

#### 通用
| 按鍵 | 動作 |
|------|------|
| `?` | 顯示說明 |
| `G` | 顯示術語表 |
| `S` | 開啟設定 |
| `q` | 退出 |

### 新增目標

使用 `a` 新增目標時，可以指定自訂設定檔：

```
https://example.com h2+tls13+warm h1+tls12+cold
```

設定檔格式：`<http>+<tls>+<conn>`
- HTTP：`h1`、`h2`
- TLS：`tls12`、`tls13`
- 連線：`warm`（重用）、`cold`（新建）

### 設定

按 `S` 開啟設定並配置：
- **UI 更新頻率**：調整更新頻率
- **連結容量**：設定頻寬以計算使用率
- **探測間隔**：探測之間的時間
- **逾時**：最大探測持續時間
- **DNS**：啟用/停用 DNS 解析計時

## 理解指標

### 統計顯示

指標顯示為 **P50/P99/Mean**：
- **P50**：中位數（第 50 百分位數）
- **P99**：第 99 百分位數（最差的 1% 樣本）
- **Mean**：算術平均值

### 結果解讀

| 指標 | 良好 | 警告 | 嚴重 |
|------|------|------|------|
| 成功率 | ≥99% | 95-99% | <95% |
| 延遲 P99 | <100ms | 100-500ms | >500ms |
| 重傳次數 | 0 | 1-3 | >3 |

### TCP 狀態指標（僅限 Linux）

TCP_INFO 指標（`cwnd`、`ssthresh`、`rtt`、`rttvar`、`retrans`、`reordering`）透過 socket 選項從核心提取。這些提供比應用層計時更精確的測量。

## 架構

```
┌─────────────────────────────────────────────────────────────┐
│                          主執行緒                            │
│  ┌─────────┐    ┌──────────┐    ┌─────────────────────────┐│
│  │ AppState│◄───│  UI 迴圈 │◄───│ crossbeam channel (rx)  ││
│  └─────────┘    └──────────┘    └─────────────────────────┘│
└─────────────────────────────────────────────────────────────┘
                                            ▲
                    ┌───────────────────────┴───────────────────────┐
                    │                                               │
        ┌───────────┴───────────┐               ┌───────────────────┴───────────┐
        │     工作執行緒 1       │               │        工作執行緒 N           │
        │  ┌─────────────────┐  │               │  ┌─────────────────────────┐  │
        │  │  ProbeClient    │  │      ...      │  │      ProbeClient        │  │
        │  │  (libcurl)      │  │               │  │      (libcurl)          │  │
        │  └─────────────────┘  │               │  └─────────────────────────┘  │
        └───────────────────────┘               └───────────────────────────────┘
```

## 系統需求

- **作業系統**：Linux（完整功能）、macOS/Windows（有限的 TCP 指標）
- **Rust**：1.92+
- **相依套件**：支援 HTTP/2 的 libcurl

## 授權條款

MIT 授權條款 - 詳見 [LICENSE](../LICENSE)。

## 貢獻

歡迎貢獻！請隨時提交問題和拉取請求。
